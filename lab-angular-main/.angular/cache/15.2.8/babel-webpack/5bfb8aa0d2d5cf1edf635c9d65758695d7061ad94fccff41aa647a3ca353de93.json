{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/core/data.service\";\nimport * as i3 from \"src/app/core/auth.service\";\nimport * as i4 from \"@angular/common\";\nfunction ProductDetailComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nfunction ProductDetailComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Name:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\")(6, \"strong\");\n    i0.ɵɵtext(7, \"Description:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\")(10, \"strong\");\n    i0.ɵɵtext(11, \"Manufacturer:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\")(14, \"strong\");\n    i0.ɵɵtext(15, \"Manufacturing Date:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p\")(18, \"strong\");\n    i0.ɵɵtext(19, \"Price:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"p\")(22, \"strong\");\n    i0.ɵɵtext(23, \"Quantity:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"p\")(26, \"strong\");\n    i0.ɵɵtext(27, \"Category:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"a\", 5);\n    i0.ɵɵtext(30, \"Back to Inventory\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.name, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.description, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.manufacturer, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.manufacturingDate, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.price, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.quantity, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.category || \"N/A\", \"\");\n  }\n}\nfunction ProductDetailComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class ProductDetailComponent {\n  constructor(route, dataService, authService) {\n    this.route = route;\n    this.dataService = dataService;\n    this.authService = authService;\n    this.product = null;\n    this.errorMessage = null;\n    this.newRating = 0;\n    this.newReview = '';\n    this.userId = 0;\n    this.currentUser = {}; // Store user details\n    this.editRatingIndex = null; // Track which rating to edit\n  }\n\n  ngOnInit() {\n    const id = +this.route.snapshot.paramMap.get('id');\n    this.userId = this.getCurrentUserId();\n    this.currentUser = JSON.parse(localStorage.getItem('user') || '{}'); // Get user details\n    this.dataService.getProductById(id).subscribe({\n      next: product => {\n        this.product = {\n          ...product,\n          availabilityStatus: this.getAvailabilityStatus(product.quantity) || 'Out of Stock'\n        };\n      },\n      error: err => this.errorMessage = err.message\n    });\n  }\n  getCurrentUserId() {\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n    return user.id || 0;\n  }\n  getAvailabilityStatus(quantity) {\n    if (quantity > 10) return 'In Stock';\n    if (quantity > 0) return 'Low Stock';\n    return 'Out of Stock';\n  }\n  submitRating() {\n    if (!this.product) return;\n    const userRating = this.product.ratings?.find(r => r.userId === this.userId);\n    if (userRating && this.editRatingIndex === null) {\n      this.errorMessage = 'You have already rated this product. Use the edit option to modify your rating.';\n      // Disable form interaction when duplicate is detected\n      this.newRating = 0;\n      this.newReview = '';\n      return;\n    }\n    if (this.newRating >= 1 && this.newRating <= 5 && this.newReview && this.product) {\n      const ratingObj = {\n        rating: this.newRating,\n        review: this.newReview,\n        userId: this.userId\n      };\n      if (this.editRatingIndex !== null) {\n        // Edit existing rating\n        this.product.ratings[this.editRatingIndex] = ratingObj;\n        this.editRatingIndex = null; // Reset edit mode\n      } else {\n        // Add new rating (if no duplicate)\n        this.product.ratings = this.product.ratings || [];\n        this.product.ratings.push(ratingObj);\n      }\n      this.dataService.updateProduct(this.product).subscribe({\n        next: () => {\n          this.newRating = 0;\n          this.newReview = '';\n          this.errorMessage = null;\n          // Refresh the component to reflect changes\n          this.ngOnInit();\n        },\n        error: err => this.errorMessage = err.message\n      });\n    } else {\n      this.errorMessage = 'Please select a rating (1-5) and provide a review.';\n    }\n  }\n  getAverageRating() {\n    if (!this.product?.ratings?.length) return 0; // Handle empty or undefined ratings\n    const sum = this.product.ratings.reduce((acc, r) => acc + r.rating, 0);\n    return Number((sum / this.product.ratings.length).toFixed(1)); // Ensure one decimal place\n  }\n\n  getUserName(userId) {\n    // Use firstName from localStorage for simplicity\n    const users = JSON.parse(localStorage.getItem('user') || '{}');\n    return users.firstName || `User ${userId}`; // Fallback to userId if name not available\n  }\n\n  startEditRating(index) {\n    if (!this.product?.ratings) return;\n    const rating = this.product.ratings[index];\n    if (rating.userId === this.userId) {\n      this.editRatingIndex = index;\n      this.newRating = rating.rating;\n      this.newReview = rating.review;\n      this.errorMessage = null; // Clear error when starting edit\n    } else {\n      this.errorMessage = 'You can only edit your own rating.';\n    }\n  }\n  getAvailabilityClass() {\n    return this.product?.availabilityStatus?.toLowerCase().replace(' ', '-') || 'out-of-stock';\n  }\n}\nProductDetailComponent.ɵfac = function ProductDetailComponent_Factory(t) {\n  return new (t || ProductDetailComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.AuthService));\n};\nProductDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductDetailComponent,\n  selectors: [[\"app-product-detail\"]],\n  decls: 7,\n  vars: 3,\n  consts: [[1, \"container\"], [1, \"card\"], [\"class\", \"error-message\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"error-message\"], [\"routerLink\", \"/inventory\"]],\n  template: function ProductDetailComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n      i0.ɵɵtext(3, \"Product Details\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(4, ProductDetailComponent_div_4_Template, 2, 1, \"div\", 2);\n      i0.ɵɵtemplate(5, ProductDetailComponent_div_5_Template, 31, 7, \"div\", 3);\n      i0.ɵɵtemplate(6, ProductDetailComponent_div_6_Template, 2, 0, \"div\", 3);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.product);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.product && !ctx.errorMessage);\n    }\n  },\n  dependencies: [i4.NgIf, i1.RouterLink],\n  styles: [\".container[_ngcontent-%COMP%] {\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n  height: 100vh;\\r\\n}\\r\\n\\r\\n.card[_ngcontent-%COMP%] {\\r\\n  background-color: #f9f9f9;\\r\\n  padding: 20px;\\r\\n  border-radius: 8px;\\r\\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\\r\\n  width: 100%;\\r\\n  max-width: 400px;\\r\\n  text-align: center;\\r\\n}\\r\\n\\r\\nh2[_ngcontent-%COMP%] {\\r\\n  text-align: center;\\r\\n}\\r\\n\\r\\n.error-message[_ngcontent-%COMP%] {\\r\\n  color: #ff0000;\\r\\n  margin-bottom: 10px;\\r\\n}\\r\\n\\r\\np[_ngcontent-%COMP%] {\\r\\n  margin: 5px 0;\\r\\n}\\r\\n\\r\\n.in-stock[_ngcontent-%COMP%] {\\r\\n  color: green;\\r\\n}\\r\\n\\r\\n.low-stock[_ngcontent-%COMP%] {\\r\\n  color: orange;\\r\\n}\\r\\n\\r\\n.out-of-stock[_ngcontent-%COMP%] {\\r\\n  color: red;\\r\\n}\\r\\n\\r\\nselect[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], button[_ngcontent-%COMP%] {\\r\\n  width: 100%;\\r\\n  margin: 5px 0;\\r\\n  padding: 8px;\\r\\n  border: 1px solid #ddd;\\r\\n  border-radius: 4px;\\r\\n}\\r\\n\\r\\nbutton[_ngcontent-%COMP%] {\\r\\n  background-color: #4CAF50;\\r\\n  color: white;\\r\\n  border: none;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\nbutton[_ngcontent-%COMP%]:hover {\\r\\n  background-color: #45a049;\\r\\n}\\r\\n\\r\\na[_ngcontent-%COMP%] {\\r\\n  display: inline-block;\\r\\n  margin-top: 10px;\\r\\n  color: #4CAF50;\\r\\n  text-decoration: none;\\r\\n}\\r\\n\\r\\na[_ngcontent-%COMP%]:hover {\\r\\n  text-decoration: underline;\\r\\n}\\r\\n\\r\\nul[_ngcontent-%COMP%] {\\r\\n  list-style-type: none;\\r\\n  padding: 0;\\r\\n  text-align: left;\\r\\n}\\r\\n\\r\\nli[_ngcontent-%COMP%] {\\r\\n  margin: 5px 0;\\r\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZmVhdHVyZXMvaW52ZW50b3J5L3Byb2R1Y3QtZGV0YWlsL3Byb2R1Y3QtZGV0YWlsLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFhO0VBQ2IsdUJBQXVCO0VBQ3ZCLG1CQUFtQjtFQUNuQixhQUFhO0FBQ2Y7O0FBRUE7RUFDRSx5QkFBeUI7RUFDekIsYUFBYTtFQUNiLGtCQUFrQjtFQUNsQix1Q0FBdUM7RUFDdkMsV0FBVztFQUNYLGdCQUFnQjtFQUNoQixrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxjQUFjO0VBQ2QsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsWUFBWTtBQUNkOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsVUFBVTtBQUNaOztBQUVBOzs7RUFHRSxXQUFXO0VBQ1gsYUFBYTtFQUNiLFlBQVk7RUFDWixzQkFBc0I7RUFDdEIsa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0UseUJBQXlCO0VBQ3pCLFlBQVk7RUFDWixZQUFZO0VBQ1osZUFBZTtBQUNqQjs7QUFFQTtFQUNFLHlCQUF5QjtBQUMzQjs7QUFFQTtFQUNFLHFCQUFxQjtFQUNyQixnQkFBZ0I7RUFDaEIsY0FBYztFQUNkLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLDBCQUEwQjtBQUM1Qjs7QUFFQTtFQUNFLHFCQUFxQjtFQUNyQixVQUFVO0VBQ1YsZ0JBQWdCO0FBQ2xCOztBQUVBO0VBQ0UsYUFBYTtBQUNmIiwic291cmNlc0NvbnRlbnQiOlsiLmNvbnRhaW5lciB7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gIGhlaWdodDogMTAwdmg7XHJcbn1cclxuXHJcbi5jYXJkIHtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5O1xyXG4gIHBhZGRpbmc6IDIwcHg7XHJcbiAgYm9yZGVyLXJhZGl1czogOHB4O1xyXG4gIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcclxuICB3aWR0aDogMTAwJTtcclxuICBtYXgtd2lkdGg6IDQwMHB4O1xyXG4gIHRleHQtYWxpZ246IGNlbnRlcjtcclxufVxyXG5cclxuaDIge1xyXG4gIHRleHQtYWxpZ246IGNlbnRlcjtcclxufVxyXG5cclxuLmVycm9yLW1lc3NhZ2Uge1xyXG4gIGNvbG9yOiAjZmYwMDAwO1xyXG4gIG1hcmdpbi1ib3R0b206IDEwcHg7XHJcbn1cclxuXHJcbnAge1xyXG4gIG1hcmdpbjogNXB4IDA7XHJcbn1cclxuXHJcbi5pbi1zdG9jayB7XHJcbiAgY29sb3I6IGdyZWVuO1xyXG59XHJcblxyXG4ubG93LXN0b2NrIHtcclxuICBjb2xvcjogb3JhbmdlO1xyXG59XHJcblxyXG4ub3V0LW9mLXN0b2NrIHtcclxuICBjb2xvcjogcmVkO1xyXG59XHJcblxyXG5zZWxlY3QsXHJcbnRleHRhcmVhLFxyXG5idXR0b24ge1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIG1hcmdpbjogNXB4IDA7XHJcbiAgcGFkZGluZzogOHB4O1xyXG4gIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7XHJcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xyXG59XHJcblxyXG5idXR0b24ge1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICM0Q0FGNTA7XHJcbiAgY29sb3I6IHdoaXRlO1xyXG4gIGJvcmRlcjogbm9uZTtcclxuICBjdXJzb3I6IHBvaW50ZXI7XHJcbn1cclxuXHJcbmJ1dHRvbjpob3ZlciB7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogIzQ1YTA0OTtcclxufVxyXG5cclxuYSB7XHJcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xyXG4gIG1hcmdpbi10b3A6IDEwcHg7XHJcbiAgY29sb3I6ICM0Q0FGNTA7XHJcbiAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xyXG59XHJcblxyXG5hOmhvdmVyIHtcclxuICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcclxufVxyXG5cclxudWwge1xyXG4gIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTtcclxuICBwYWRkaW5nOiAwO1xyXG4gIHRleHQtYWxpZ246IGxlZnQ7XHJcbn1cclxuXHJcbmxpIHtcclxuICBtYXJnaW46IDVweCAwO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["i0","ProductDetailComponent","constructor","route","dataService","authService","ngOnInit","id","snapshot","paramMap","get","userId","getCurrentUserId","currentUser","JSON","parse","localStorage","getItem","getProductById","subscribe","next","product","availabilityStatus","getAvailabilityStatus","quantity","error","err","errorMessage","message","user","submitRating","userRating","ratings","find","r","editRatingIndex","newRating","newReview","ratingObj","rating","review","push","updateProduct","getAverageRating","length","sum","reduce","acc","Number","toFixed","getUserName","users","firstName","startEditRating","index","getAvailabilityClass","toLowerCase","replace","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\malik\\Downloads\\Evaluation\\lab-angular-main\\src\\app\\features\\inventory\\product-detail\\product-detail.component.html","C:\\Users\\malik\\Downloads\\Evaluation\\lab-angular-main\\src\\app\\features\\inventory\\product-detail\\product-detail.component.ts"],"sourcesContent":["<div class=\"container\">\r\n  <div class=\"card\">\r\n    <h2>Product Details</h2>\r\n    <div *ngIf=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</div>\r\n    <div *ngIf=\"product\">\r\n      <p><strong>Name:</strong> {{ product.name }}</p>\r\n      <p><strong>Description:</strong> {{ product.description }}</p>\r\n      <p><strong>Manufacturer:</strong> {{ product.manufacturer }}</p>\r\n      <p><strong>Manufacturing Date:</strong> {{ product.manufacturingDate }}</p>\r\n      <p><strong>Price:</strong> {{ product.price }}</p>\r\n      <p><strong>Quantity:</strong> {{ product.quantity }}</p>\r\n      <p><strong>Category:</strong> {{ product.category || 'N/A' }}</p>\r\n      <a routerLink=\"/inventory\">Back to Inventory</a>\r\n    </div>\r\n    <div *ngIf=\"!product && !errorMessage\">Loading...</div>\r\n  </div>\r\n</div>","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { DataService } from 'src/app/core/data.service';\nimport { Product } from 'src/app/shared/models/product.mode';\nimport { AuthService } from 'src/app/core/auth.service';\n\n@Component({\n  selector: 'app-product-detail',\n  templateUrl: './product-detail.component.html',\n  styleUrls: ['./product-detail.component.css']\n})\nexport class ProductDetailComponent implements OnInit {\n  product: Product | null = null;\n  errorMessage: string | null = null;\n  newRating: number = 0;\n  newReview: string = '';\n  userId: number = 0;\n  currentUser: any = {}; // Store user details\n  editRatingIndex: number | null = null; // Track which rating to edit\n\n  constructor(\n    private route: ActivatedRoute,\n    private dataService: DataService,\n    private authService: AuthService\n  ) {}\n\n  ngOnInit(): void {\n    const id = +this.route.snapshot.paramMap.get('id')!;\n    this.userId = this.getCurrentUserId();\n    this.currentUser = JSON.parse(localStorage.getItem('user') || '{}'); // Get user details\n    this.dataService.getProductById(id).subscribe({\n      next: (product: Product) => {\n        this.product = {\n          ...product,\n          availabilityStatus: this.getAvailabilityStatus(product.quantity) || 'Out of Stock'\n        };\n      },\n      error: (err: Error) => this.errorMessage = err.message\n    });\n  }\n\n  getCurrentUserId(): number {\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n    return user.id || 0;\n  }\n\n  getAvailabilityStatus(quantity: number): string {\n    if (quantity > 10) return 'In Stock';\n    if (quantity > 0) return 'Low Stock';\n    return 'Out of Stock';\n  }\n\n  submitRating(): void {\n    if (!this.product) return;\n\n    const userRating = this.product.ratings?.find(r => r.userId === this.userId);\n    if (userRating && this.editRatingIndex === null) {\n      this.errorMessage = 'You have already rated this product. Use the edit option to modify your rating.';\n      // Disable form interaction when duplicate is detected\n      this.newRating = 0;\n      this.newReview = '';\n      return;\n    }\n\n    if (this.newRating >= 1 && this.newRating <= 5 && this.newReview && this.product) {\n      const ratingObj = { rating: this.newRating, review: this.newReview, userId: this.userId };\n      if (this.editRatingIndex !== null) {\n        // Edit existing rating\n        this.product.ratings![this.editRatingIndex] = ratingObj;\n        this.editRatingIndex = null; // Reset edit mode\n      } else {\n        // Add new rating (if no duplicate)\n        this.product.ratings = this.product.ratings || [];\n        this.product.ratings.push(ratingObj);\n      }\n      this.dataService.updateProduct(this.product).subscribe({\n        next: () => {\n          this.newRating = 0;\n          this.newReview = '';\n          this.errorMessage = null;\n          // Refresh the component to reflect changes\n          this.ngOnInit();\n        },\n        error: (err: Error) => this.errorMessage = err.message\n      });\n    } else {\n      this.errorMessage = 'Please select a rating (1-5) and provide a review.';\n    }\n  }\n\n  getAverageRating(): number {\n    if (!this.product?.ratings?.length) return 0; // Handle empty or undefined ratings\n    const sum = this.product.ratings.reduce((acc, r) => acc + r.rating, 0);\n    return Number((sum / this.product.ratings.length).toFixed(1)); // Ensure one decimal place\n  }\n\n  getUserName(userId: number): string {\n    // Use firstName from localStorage for simplicity\n    const users = JSON.parse(localStorage.getItem('user') || '{}');\n    return users.firstName || `User ${userId}`; // Fallback to userId if name not available\n  }\n\n  startEditRating(index: number): void {\n    if (!this.product?.ratings) return;\n    const rating = this.product.ratings[index];\n    if (rating.userId === this.userId) {\n      this.editRatingIndex = index;\n      this.newRating = rating.rating;\n      this.newReview = rating.review;\n      this.errorMessage = null; // Clear error when starting edit\n    } else {\n      this.errorMessage = 'You can only edit your own rating.';\n    }\n  }\n\n  getAvailabilityClass(): string {\n    return this.product?.availabilityStatus?.toLowerCase().replace(' ', '-') || 'out-of-stock';\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}