{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/core/data.service\";\nimport * as i3 from \"src/app/core/auth.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction ProductDetailComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nfunction ProductDetailComponent_div_5_div_14_li_4_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ProductDetailComponent_div_5_div_14_li_4_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const i_r7 = i0.ɵɵnextContext().index;\n      const ctx_r9 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r9.startEditRating(i_r7));\n    });\n    i0.ɵɵtext(1, \"Edit\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductDetailComponent_div_5_div_14_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, ProductDetailComponent_div_5_div_14_li_4_button_2_Template, 2, 0, \"button\", 13);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const rating_r6 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\" \", ctx_r5.getUserName(rating_r6.userId), \": \", rating_r6.rating, \" stars - \\\"\", rating_r6.review, \"\\\" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.userId === rating_r6.userId);\n  }\n}\nfunction ProductDetailComponent_div_5_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Reviews\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\");\n    i0.ɵɵtemplate(4, ProductDetailComponent_div_5_div_14_li_4_Template, 3, 4, \"li\", 12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.product.ratings);\n  }\n}\nfunction ProductDetailComponent_div_5_option_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r12 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", i_r12);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i_r12);\n  }\n}\nconst _c0 = function () {\n  return [1, 2, 3, 4, 5];\n};\nfunction ProductDetailComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Name:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\")(6, \"strong\");\n    i0.ɵɵtext(7, \"Availability:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"span\", 5);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"p\")(11, \"strong\");\n    i0.ɵɵtext(12, \"Average Rating:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(14, ProductDetailComponent_div_5_div_14_Template, 5, 1, \"div\", 3);\n    i0.ɵɵelementStart(15, \"div\")(16, \"h3\");\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"select\", 6);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductDetailComponent_div_5_Template_select_ngModelChange_18_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.newRating = $event);\n    });\n    i0.ɵɵelementStart(19, \"option\", 7);\n    i0.ɵɵtext(20, \"Select Rating\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(21, ProductDetailComponent_div_5_option_21_Template, 2, 2, \"option\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"textarea\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductDetailComponent_div_5_Template_textarea_ngModelChange_22_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.newReview = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ProductDetailComponent_div_5_Template_button_click_23_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.submitRating());\n    });\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"a\", 11);\n    i0.ɵɵtext(26, \"Back to Inventory\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.product.name, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", ctx_r1.getAvailabilityClass());\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r1.product.availabilityStatus);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getAverageRating(), \" / 5\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.product.ratings == null ? null : ctx_r1.product.ratings.length);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r1.editRatingIndex !== null ? \"Edit Rating\" : \"Add Rating\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.newRating);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(10, _c0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.newReview);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.editRatingIndex !== null ? \"Update Rating\" : \"Submit\");\n  }\n}\nfunction ProductDetailComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class ProductDetailComponent {\n  constructor(route, dataService, authService) {\n    this.route = route;\n    this.dataService = dataService;\n    this.authService = authService;\n    this.product = null;\n    this.errorMessage = null;\n    this.newRating = 0;\n    this.newReview = '';\n    this.userId = 0;\n    this.currentUser = {}; // Store user details\n    this.editRatingIndex = null;\n  }\n  ngOnInit() {\n    const id = +this.route.snapshot.paramMap.get('id');\n    this.userId = this.getCurrentUserId();\n    this.currentUser = JSON.parse(localStorage.getItem('user') || '{}'); // Get user details\n    this.dataService.getProductById(id).subscribe({\n      next: product => {\n        this.product = {\n          ...product,\n          availabilityStatus: this.getAvailabilityStatus(product.quantity) || 'Out of Stock'\n        };\n      },\n      error: err => this.errorMessage = err.message\n    });\n  }\n  getCurrentUserId() {\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n    return user.id || 0;\n  }\n  getAvailabilityStatus(quantity) {\n    if (quantity > 10) return 'In Stock';\n    if (quantity > 0) return 'Low Stock';\n    return 'Out of Stock';\n  }\n  submitRating() {\n    if (!this.product) return;\n    const userRating = this.product.ratings?.find(r => r.userId === this.userId);\n    if (userRating && this.editRatingIndex === null) {\n      this.errorMessage = 'You have already rated this product. Use the edit option to modify your rating.';\n      return;\n    }\n    if (this.newRating >= 1 && this.newRating <= 5 && this.newReview && this.product) {\n      const ratingObj = {\n        rating: this.newRating,\n        review: this.newReview,\n        userId: this.userId\n      };\n      if (this.editRatingIndex !== null) {\n        // Edit existing rating\n        this.product.ratings[this.editRatingIndex] = ratingObj;\n        this.editRatingIndex = null; // Reset edit mode\n      } else {\n        // Add new rating (if no duplicate)\n        this.product.ratings = this.product.ratings || [];\n        this.product.ratings.push(ratingObj);\n      }\n      this.dataService.updateProduct(this.product).subscribe({\n        next: () => {\n          this.newRating = 0;\n          this.newReview = '';\n          this.errorMessage = null;\n          alert('Rating and review submitted/updated successfully!');\n        },\n        error: err => this.errorMessage = err.message\n      });\n    } else {\n      this.errorMessage = 'Please select a rating (1-5) and provide a review.';\n    }\n  }\n  getAverageRating() {\n    if (!this.product?.ratings?.length) return 0; // Handle empty or undefined ratings\n    const sum = this.product.ratings.reduce((acc, r) => acc + r.rating, 0);\n    return Number((sum / this.product.ratings.length).toFixed(1)); // Round to 1 decimal\n  }\n\n  getUserName(userId) {\n    // For simplicity, use firstName from localStorage; in a real app, fetch from backend\n    const users = JSON.parse(localStorage.getItem('user') || '{}');\n    return users.firstName || `User ${userId}`; // Fallback to userId if name not available\n  }\n\n  startEditRating(index) {\n    if (!this.product?.ratings) return;\n    const rating = this.product.ratings[index];\n    if (rating.userId === this.userId) {\n      this.editRatingIndex = index;\n      this.newRating = rating.rating;\n      this.newReview = rating.review;\n    } else {\n      this.errorMessage = 'You can only edit your own rating.';\n    }\n  }\n  getAvailabilityClass() {\n    return this.product?.availabilityStatus?.toLowerCase().replace(' ', '-') || 'out-of-stock';\n  }\n}\nProductDetailComponent.ɵfac = function ProductDetailComponent_Factory(t) {\n  return new (t || ProductDetailComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.AuthService));\n};\nProductDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductDetailComponent,\n  selectors: [[\"app-product-detail\"]],\n  decls: 7,\n  vars: 3,\n  consts: [[1, \"container\"], [1, \"card\"], [\"class\", \"error-message\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"error-message\"], [3, \"ngClass\"], [3, \"ngModel\", \"ngModelChange\"], [\"value\", \"0\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"placeholder\", \"Write a review\", 3, \"ngModel\", \"ngModelChange\"], [3, \"click\"], [\"routerLink\", \"/inventory\"], [4, \"ngFor\", \"ngForOf\"], [3, \"click\", 4, \"ngIf\"], [3, \"value\"]],\n  template: function ProductDetailComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n      i0.ɵɵtext(3, \"Product Details\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(4, ProductDetailComponent_div_4_Template, 2, 1, \"div\", 2);\n      i0.ɵɵtemplate(5, ProductDetailComponent_div_5_Template, 27, 11, \"div\", 3);\n      i0.ɵɵtemplate(6, ProductDetailComponent_div_6_Template, 2, 0, \"div\", 3);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.product);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.product && !ctx.errorMessage);\n    }\n  },\n  dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.DefaultValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgModel, i1.RouterLink],\n  styles: [\".container[_ngcontent-%COMP%] {\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n  height: 100vh;\\r\\n}\\r\\n\\r\\n.card[_ngcontent-%COMP%] {\\r\\n  background-color: #f9f9f9;\\r\\n  padding: 20px;\\r\\n  border-radius: 8px;\\r\\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\\r\\n  width: 100%;\\r\\n  max-width: 400px;\\r\\n  text-align: center;\\r\\n}\\r\\n\\r\\nh2[_ngcontent-%COMP%] {\\r\\n  text-align: center;\\r\\n}\\r\\n\\r\\n.error-message[_ngcontent-%COMP%] {\\r\\n  color: #ff0000;\\r\\n  margin-bottom: 10px;\\r\\n}\\r\\n\\r\\np[_ngcontent-%COMP%] {\\r\\n  margin: 5px 0;\\r\\n}\\r\\n\\r\\n.in-stock[_ngcontent-%COMP%] {\\r\\n  color: green;\\r\\n}\\r\\n\\r\\n.low-stock[_ngcontent-%COMP%] {\\r\\n  color: orange;\\r\\n}\\r\\n\\r\\n.out-of-stock[_ngcontent-%COMP%] {\\r\\n  color: red;\\r\\n}\\r\\n\\r\\nselect[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], button[_ngcontent-%COMP%] {\\r\\n  width: 100%;\\r\\n  margin: 5px 0;\\r\\n  padding: 8px;\\r\\n  border: 1px solid #ddd;\\r\\n  border-radius: 4px;\\r\\n}\\r\\n\\r\\nbutton[_ngcontent-%COMP%] {\\r\\n  background-color: #4CAF50;\\r\\n  color: white;\\r\\n  border: none;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\nbutton[_ngcontent-%COMP%]:hover {\\r\\n  background-color: #45a049;\\r\\n}\\r\\n\\r\\na[_ngcontent-%COMP%] {\\r\\n  display: inline-block;\\r\\n  margin-top: 10px;\\r\\n  color: #4CAF50;\\r\\n  text-decoration: none;\\r\\n}\\r\\n\\r\\na[_ngcontent-%COMP%]:hover {\\r\\n  text-decoration: underline;\\r\\n}\\r\\n\\r\\nul[_ngcontent-%COMP%] {\\r\\n  list-style-type: none;\\r\\n  padding: 0;\\r\\n  text-align: left;\\r\\n}\\r\\n\\r\\nli[_ngcontent-%COMP%] {\\r\\n  margin: 5px 0;\\r\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZmVhdHVyZXMvaW52ZW50b3J5L3Byb2R1Y3QtZGV0YWlsL3Byb2R1Y3QtZGV0YWlsLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFhO0VBQ2IsdUJBQXVCO0VBQ3ZCLG1CQUFtQjtFQUNuQixhQUFhO0FBQ2Y7O0FBRUE7RUFDRSx5QkFBeUI7RUFDekIsYUFBYTtFQUNiLGtCQUFrQjtFQUNsQix1Q0FBdUM7RUFDdkMsV0FBVztFQUNYLGdCQUFnQjtFQUNoQixrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxjQUFjO0VBQ2QsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsWUFBWTtBQUNkOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsVUFBVTtBQUNaOztBQUVBOzs7RUFHRSxXQUFXO0VBQ1gsYUFBYTtFQUNiLFlBQVk7RUFDWixzQkFBc0I7RUFDdEIsa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0UseUJBQXlCO0VBQ3pCLFlBQVk7RUFDWixZQUFZO0VBQ1osZUFBZTtBQUNqQjs7QUFFQTtFQUNFLHlCQUF5QjtBQUMzQjs7QUFFQTtFQUNFLHFCQUFxQjtFQUNyQixnQkFBZ0I7RUFDaEIsY0FBYztFQUNkLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLDBCQUEwQjtBQUM1Qjs7QUFFQTtFQUNFLHFCQUFxQjtFQUNyQixVQUFVO0VBQ1YsZ0JBQWdCO0FBQ2xCOztBQUVBO0VBQ0UsYUFBYTtBQUNmIiwic291cmNlc0NvbnRlbnQiOlsiLmNvbnRhaW5lciB7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gIGhlaWdodDogMTAwdmg7XHJcbn1cclxuXHJcbi5jYXJkIHtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5O1xyXG4gIHBhZGRpbmc6IDIwcHg7XHJcbiAgYm9yZGVyLXJhZGl1czogOHB4O1xyXG4gIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcclxuICB3aWR0aDogMTAwJTtcclxuICBtYXgtd2lkdGg6IDQwMHB4O1xyXG4gIHRleHQtYWxpZ246IGNlbnRlcjtcclxufVxyXG5cclxuaDIge1xyXG4gIHRleHQtYWxpZ246IGNlbnRlcjtcclxufVxyXG5cclxuLmVycm9yLW1lc3NhZ2Uge1xyXG4gIGNvbG9yOiAjZmYwMDAwO1xyXG4gIG1hcmdpbi1ib3R0b206IDEwcHg7XHJcbn1cclxuXHJcbnAge1xyXG4gIG1hcmdpbjogNXB4IDA7XHJcbn1cclxuXHJcbi5pbi1zdG9jayB7XHJcbiAgY29sb3I6IGdyZWVuO1xyXG59XHJcblxyXG4ubG93LXN0b2NrIHtcclxuICBjb2xvcjogb3JhbmdlO1xyXG59XHJcblxyXG4ub3V0LW9mLXN0b2NrIHtcclxuICBjb2xvcjogcmVkO1xyXG59XHJcblxyXG5zZWxlY3QsXHJcbnRleHRhcmVhLFxyXG5idXR0b24ge1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIG1hcmdpbjogNXB4IDA7XHJcbiAgcGFkZGluZzogOHB4O1xyXG4gIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7XHJcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xyXG59XHJcblxyXG5idXR0b24ge1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICM0Q0FGNTA7XHJcbiAgY29sb3I6IHdoaXRlO1xyXG4gIGJvcmRlcjogbm9uZTtcclxuICBjdXJzb3I6IHBvaW50ZXI7XHJcbn1cclxuXHJcbmJ1dHRvbjpob3ZlciB7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogIzQ1YTA0OTtcclxufVxyXG5cclxuYSB7XHJcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xyXG4gIG1hcmdpbi10b3A6IDEwcHg7XHJcbiAgY29sb3I6ICM0Q0FGNTA7XHJcbiAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xyXG59XHJcblxyXG5hOmhvdmVyIHtcclxuICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcclxufVxyXG5cclxudWwge1xyXG4gIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTtcclxuICBwYWRkaW5nOiAwO1xyXG4gIHRleHQtYWxpZ246IGxlZnQ7XHJcbn1cclxuXHJcbmxpIHtcclxuICBtYXJnaW46IDVweCAwO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["i0","ProductDetailComponent","constructor","route","dataService","authService","ngOnInit","id","snapshot","paramMap","get","userId","getCurrentUserId","currentUser","JSON","parse","localStorage","getItem","getProductById","subscribe","next","product","availabilityStatus","getAvailabilityStatus","quantity","error","err","errorMessage","message","user","submitRating","userRating","ratings","find","r","editRatingIndex","newRating","newReview","ratingObj","rating","review","push","updateProduct","alert","getAverageRating","length","sum","reduce","acc","Number","toFixed","getUserName","users","firstName","startEditRating","index","getAvailabilityClass","toLowerCase","replace","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\malik\\Downloads\\Evaluation\\lab-angular-main\\src\\app\\features\\inventory\\product-detail\\product-detail.component.html","C:\\Users\\malik\\Downloads\\Evaluation\\lab-angular-main\\src\\app\\features\\inventory\\product-detail\\product-detail.component.ts"],"sourcesContent":["<div class=\"container\">\r\n  <div class=\"card\">\r\n    <h2>Product Details</h2>\r\n    <div *ngIf=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</div>\r\n    <div *ngIf=\"product\">\r\n      <p><strong>Name:</strong> {{ product.name }}</p>\r\n      <p><strong>Availability:</strong> <span [ngClass]=\"getAvailabilityClass()\">{{ product.availabilityStatus }}</span></p>\r\n      <p><strong>Average Rating:</strong> {{ getAverageRating() }} / 5</p>\r\n      <div *ngIf=\"product.ratings?.length\">\r\n        <h3>Reviews</h3>\r\n        <ul>\r\n          <li *ngFor=\"let rating of product.ratings; let i = index\">\r\n            {{ getUserName(rating.userId) }}: {{ rating.rating }} stars - \"{{ rating.review }}\"\r\n            <button *ngIf=\"userId === rating.userId\" (click)=\"startEditRating(i)\">Edit</button>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <div>\r\n        <h3>{{ editRatingIndex !== null ? 'Edit Rating' : 'Add Rating' }}</h3>\r\n        <select [(ngModel)]=\"newRating\">\r\n          <option value=\"0\">Select Rating</option>\r\n          <option *ngFor=\"let i of [1, 2, 3, 4, 5]\" [value]=\"i\">{{ i }}</option>\r\n        </select>\r\n        <textarea [(ngModel)]=\"newReview\" placeholder=\"Write a review\"></textarea>\r\n        <button (click)=\"submitRating()\">{{ editRatingIndex !== null ? 'Update Rating' : 'Submit' }}</button>\r\n      </div>\r\n      <a routerLink=\"/inventory\">Back to Inventory</a>\r\n    </div>\r\n    <div *ngIf=\"!product && !errorMessage\">Loading...</div>\r\n  </div>\r\n</div>","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { DataService } from 'src/app/core/data.service';\nimport { Product } from 'src/app/shared/models/product.mode';\nimport { AuthService } from 'src/app/core/auth.service';\n\n@Component({\n  selector: 'app-product-detail',\n  templateUrl: './product-detail.component.html',\n  styleUrls: ['./product-detail.component.css']\n})\nexport class ProductDetailComponent implements OnInit {\n  product: Product | null = null;\n  errorMessage: string | null = null;\n  newRating: number = 0;\n  newReview: string = '';\n  userId: number = 0;\n  currentUser: any = {}; // Store user details\n  editRatingIndex: number | null = null;\n  fir // Track which rating to edit\n\n  constructor(\n    private route: ActivatedRoute,\n    private dataService: DataService,\n    private authService: AuthService\n  ) {}\n\n  ngOnInit(): void {\n    const id = +this.route.snapshot.paramMap.get('id')!;\n    this.userId = this.getCurrentUserId();\n    this.currentUser = JSON.parse(localStorage.getItem('user') || '{}'); // Get user details\n    this.dataService.getProductById(id).subscribe({\n      next: (product: Product) => {\n        this.product = {\n          ...product,\n          availabilityStatus: this.getAvailabilityStatus(product.quantity) || 'Out of Stock'\n        };\n      },\n      error: (err: Error) => this.errorMessage = err.message\n    });\n  }\n\n  getCurrentUserId(): number {\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n    return user.id || 0;\n  }\n\n  getAvailabilityStatus(quantity: number): string {\n    if (quantity > 10) return 'In Stock';\n    if (quantity > 0) return 'Low Stock';\n    return 'Out of Stock';\n  }\n\n  submitRating(): void {\n    if (!this.product) return;\n\n    const userRating = this.product.ratings?.find(r => r.userId === this.userId);\n    if (userRating && this.editRatingIndex === null) {\n      this.errorMessage = 'You have already rated this product. Use the edit option to modify your rating.';\n      return;\n    }\n\n    if (this.newRating >= 1 && this.newRating <= 5 && this.newReview && this.product) {\n      const ratingObj = { rating: this.newRating, review: this.newReview, userId: this.userId };\n      if (this.editRatingIndex !== null) {\n        // Edit existing rating\n        this.product.ratings![this.editRatingIndex] = ratingObj;\n        this.editRatingIndex = null; // Reset edit mode\n      } else {\n        // Add new rating (if no duplicate)\n        this.product.ratings = this.product.ratings || [];\n        this.product.ratings.push(ratingObj);\n      }\n      this.dataService.updateProduct(this.product).subscribe({\n        next: () => {\n          this.newRating = 0;\n          this.newReview = '';\n          this.errorMessage = null;\n          alert('Rating and review submitted/updated successfully!');\n        },\n        error: (err: Error) => this.errorMessage = err.message\n      });\n    } else {\n      this.errorMessage = 'Please select a rating (1-5) and provide a review.';\n    }\n  }\n\n  getAverageRating(): number {\n    if (!this.product?.ratings?.length) return 0; // Handle empty or undefined ratings\n    const sum = this.product.ratings.reduce((acc, r) => acc + r.rating, 0);\n    return Number((sum / this.product.ratings.length).toFixed(1)); // Round to 1 decimal\n  }\n\n  getUserName(userId: number): string {\n    // For simplicity, use firstName from localStorage; in a real app, fetch from backend\n    const users = JSON.parse(localStorage.getItem('user') || '{}');\n    return users.firstName || `User ${userId}`; // Fallback to userId if name not available\n  }\n\n  startEditRating(index: number): void {\n    if (!this.product?.ratings) return;\n    const rating = this.product.ratings[index];\n    if (rating.userId === this.userId) {\n      this.editRatingIndex = index;\n      this.newRating = rating.rating;\n      this.newReview = rating.review;\n    } else {\n      this.errorMessage = 'You can only edit your own rating.';\n    }\n  }\n\n  getAvailabilityClass(): string {\n    return this.product?.availabilityStatus?.toLowerCase().replace(' ', '-') || 'out-of-stock';\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}